# Changelog - November 12, 2025

## Email Validation Fixes

### Fixed Email Validation Issues in Order Import

**Problem:**
- Email validation was incorrectly flagging valid emails like "emily.rodriguez@sampledist4.com" as invalid
- Error message showed "[object Object]" when ExcelJS returned object types instead of strings

**Solution:**
1. **Enhanced Email Parsing** (`lib/excel/parser.ts`):
   - Created `parseEmail()` helper function to safely convert email values to strings
   - Handles various ExcelJS cell types:
     - Strings (with trimming)
     - Date objects (returns undefined)
     - ExcelJS hyperlink objects (extracts text property)
     - ExcelJS rich text objects (extracts text from richText array)
     - Formula result objects (recursively processes)
     - Other objects with custom toString methods
   - Returns `undefined` for unconvertible objects to prevent "[object Object]" errors

2. **Improved Email Validation** (`lib/excel/validator.ts`):
   - Added email trimming before validation to handle whitespace issues
   - Updated regex pattern from `/^[^\s@]+@[^\s@]+\.[^\s@]+$/` to `/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/`
   - More robust pattern allows dots, hyphens, numbers, and common special characters
   - Enhanced error messages to show the actual email value being validated
   - Added check for empty strings after trimming

3. **Improved Cell Value Extraction** (`lib/excel/parser.ts`):
   - Enhanced `getCellValue()` function to handle ExcelJS hyperlink objects
   - Extracts text property from hyperlink objects early in the process

**Files Modified:**
- `lib/excel/parser.ts` - Added `parseEmail()` function and improved `getCellValue()`
- `lib/excel/validator.ts` - Enhanced email validation with trimming and better regex

**Impact:**
- Valid emails are now correctly validated even with leading/trailing whitespace
- Object types from ExcelJS are properly converted to strings
- Better error messages help users identify validation issues
- Prevents "[object Object]" errors in validation

